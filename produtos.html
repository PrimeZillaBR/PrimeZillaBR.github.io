<script>
// URL do JSON que o admin atualiza no GitHub
const PROD_URL = "https://raw.githubusercontent.com/PrimeZillaBR/PrimeZillaBR.github.io/main/produtos.json";
const PHONE = "5567992018672";

const grid = document.getElementById('productsGrid');
let produtos = [];

// Carregar produtos do GitHub JSON
async function loadProducts() {
  try {
    grid.innerHTML = "Carregando...";
    const res = await fetch(PROD_URL, { cache: "no-store" });
    if (!res.ok) throw new Error("Erro ao carregar produtos.json");
    produtos = await res.json();
    render("all");
    bindFilters();
  } catch (err) {
    console.error(err);
    grid.innerHTML = "<p>Erro ao carregar produtos.</p>";
  }
}

// Segurança HTML
function esc(s) {
  return String(s || "").replace(/[&<>\"']/g, m =>
    ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", "\"": "&quot;", "'": "&#39;" }[m])
  );
}

// Botões de categoria
function bindFilters() {
  document.querySelectorAll(".catBtn").forEach(btn => {
    btn.onclick = () => render(btn.dataset.cat);
  });
}

// Renderização
function render(filter) {
  grid.innerHTML = "";

  produtos.forEach(p => {
    if (!p.active) return;
    if (filter !== "all" && p.category !== filter) return;

    const img = p.imageUrl || p.image || "placeholder.png";
    const priceText = p.price ? `R$ ${Number(p.price).toFixed(2)}` : "Consultar valores";

    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <img src="${esc(img)}" alt="${esc(p.name)}">
      <h3>${esc(p.name)}</h3>
      <p class="price">${esc(priceText)}</p>
      <a class="botao buy">Comprar</a>
    `;

    div.querySelector(".buy").onclick = () => {
      const variantLabel = p.type === "pod" ? "Sabor" : "Cor";
      const variant = p.options && p.options[0] ? p.options[0] : "-";
      const text = encodeURIComponent(
        `Olá! Tenho interesse no produto: ${p.name}
Quantidade: 1
${variantLabel}: ${variant}
Valor: ${priceText}
Forma de Pagamento: PIX`
      );
      window.open(`https://wa.me/${PHONE}?text=${text}`, "_blank");
    };

    grid.appendChild(div);
  });

  if (grid.children.length === 0) {
    grid.innerHTML = "<p>Nenhum item nesta categoria.</p>";
  }
}

// iniciar
loadProducts();
</script>
