<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PrimeZilla — Loja</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<header class="topo">
  <img src="logo.png" class="logo" alt="PrimeZilla">
  <nav>
    <a href="index.html">Início</a>
    <a href="produtos.html">Produtos</a>
    <a href="admin.html">Admin</a>
    <a href="contato.html">Contato</a>
  </nav>
</header>

<main>
  <section class="hero">
    <h1>PrimeZilla</h1>
    <p>Produtos selecionados — clique e compre pelo WhatsApp</p>
  </section>

  <section class="catalog">
    <div id="productsGrid" class="grid"></div>
  </section>
</main>

<footer>© 2025 PrimeZilla</footer>

<script>
// Lê produtos.json e monta a grade
async function loadProducts() {
  try {
    const res = await fetch('/produtos.json', {cache: "no-store"});
    const products = await res.json();
    const grid = document.getElementById('productsGrid');
    grid.innerHTML = '';
    products.filter(p=>p.active).forEach(p=>{
      const imgSrc = (p.image && p.image.startsWith('data:')) ? p.image : (p.image || 'placeholder.png');
      const priceText = p.price ? `${p.currency} ${Number(p.price).toFixed(2)}` : 'Consultar valores';
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${imgSrc}" alt="${escapeHtml(p.name)}">
        <h3>${escapeHtml(p.name)}</h3>
        <p class="price">${priceText}</p>
        <div class="actions">
          <label>Qtd <select class="sel-qty"><option>1</option><option>2</option><option>3</option></select></label>
          ${(p.type==='pod')?`<label>Sabor <select class="sel-variant">${(p.options||[]).map(o=>`<option>${o}</option>`).join('')}</select></label>`:
          `<label>Cor <select class="sel-variant">${(p.options&&p.options.length)?(p.options.map(o=>`<option>${o}</option>`).join('')):`<option>-</option>`}</select></label>`}
          <label>Pagamento <select class="sel-pay"><option>PIX</option><option>Dinheiro</option><option>Cartão</option></select></label>
        </div>
        <a class="botao whatsappBtn" href="#">Fazer pedido</a>
      `;
      // evento do botao
      card.querySelector('.whatsappBtn').addEventListener('click', ()=>{
        const qty = card.querySelector('.sel-qty').value;
        const variant = card.querySelector('.sel-variant').value || '-';
        const pay = card.querySelector('.sel-pay').value;
        const valorText = p.price ? `${p.currency} ${Number(p.price).toFixed(2)}` : 'Consultar valores';
        const variantLabel = (p.type==='pod') ? 'Sabor' : 'Cor';
        const text = encodeURIComponent(`Olá! Tenho interesse no produto: ${p.name}\nQuantidade: ${qty}\n${variantLabel}: ${variant}\nValor: ${valorText}\nForma de Pagamento: ${pay}`);
        const phone = '5567992018672';
        window.open(`https://wa.me/${phone}?text=${text}`,'_blank');
      });
      grid.appendChild(card);
    });
  } catch (err) {
    console.error(err);
    document.getElementById('productsGrid').innerHTML = '<p>Erro ao carregar produtos.</p>';
  }
}
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
loadProducts();
</script>

</body>
</html>
