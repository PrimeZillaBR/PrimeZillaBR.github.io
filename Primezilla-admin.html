<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin - PrimeZilla</title>
<link rel="stylesheet" href="style.css">
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, serverTimestamp, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

  // --- coloque seu firebaseConfig aqui ---
  const firebaseConfig = {
    apiKey: "SUA_API_KEY",
    authDomain: "SEU_AUTH_DOMAIN",
    projectId: "SEU_PROJECT_ID",
    storageBucket: "SEU_STORAGE_BUCKET",
    messagingSenderId: "SEU_SENDER_ID",
    appId: "SEU_APP_ID"
  };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const storage = getStorage(app);

  document.addEventListener('DOMContentLoaded', ()=>{
    const loginForm = document.getElementById('loginForm');
    const adminArea = document.getElementById('adminArea');
    const status = document.getElementById('status');
    const addForm = document.getElementById('addForm');

    loginForm.addEventListener('submit', async (ev)=>{
      ev.preventDefault();
      const email = loginForm.email.value;
      const pass = loginForm.password.value;
      try{
        await signInWithEmailAndPassword(auth,email,pass);
        loginForm.style.display='none';
        adminArea.style.display='block';
        status.textContent = 'Conectado';
      }catch(err){ alert('Erro login: '+err.message); }
    });

    addForm.addEventListener('submit', async ev=>{
      ev.preventDefault();
      const name = addForm.name.value.trim();
      const price = parseFloat(addForm.price.value) || 0;
      const category = addForm.category.value;
      const type = addForm.type.value; // 'pod' or 'non-pod'
      const optionsRaw = addForm.options.value.trim(); // separado por vírgula
      const options = optionsRaw ? optionsRaw.split(',').map(s=>s.trim()) : [];
      const file = addForm.image.files[0];
      if(!name){ return alert('Coloque nome'); }

      // upload de imagem (se houver)
      let imageUrl = '';
      if(file){
        const path = `products/${Date.now()}_${file.name}`;
        const stRef = ref(storage,path);
        await uploadBytes(stRef,file);
        imageUrl = await getDownloadURL(stRef);
      }
      // criar doc
      await addDoc(collection(db,'products'), {
        name, price, category, type,
        options,
        imageUrl,
        active: true,
        createdAt: serverTimestamp()
      });
      alert('Produto criado');
      addForm.reset();
    });

    // logout
    document.getElementById('logout').addEventListener('click', ()=> signOut(auth).then(()=> location.reload()));

    // TODO: listar produtos + editar/excluir (posso te entregar já se quiser)
  });
</script>
</head>
<body>
<div style="max-width:920px;margin:18px auto;padding:12px">
  <h2>Admin - PrimeZilla</h2>
  <div id="loginFormWrap">
    <form id="loginForm">
      <input name="email" placeholder="Email" required><br><br>
      <input type="password" name="password" placeholder="Senha" required><br><br>
      <button type="submit">Entrar</button>
    </form>
  </div>

  <div id="adminArea" style="display:none">
    <p id="status">Conectando...</p>
    <button id="logout">Logout</button>
    <hr>
    <h3>Adicionar produto</h3>
    <form id="addForm">
      <input name="name" placeholder="Nome do produto" required><br><br>
      <input name="price" placeholder="Preço (somente números)" ><br><br>
      <select name="category">
        <option value="pods">Pods</option>
        <option value="acessorios">Acessórios</option>
        <option value="eletronicos">Eletrônicos</option>
        <option value="outros">Outros</option>
      </select><br><br>
      <select name="type">
        <option value="pod">Pod (usar campo sabores)</option>
        <option value="non-pod">Não-pod (usar cores)</option>
      </select><br><br>
      <input name="options" placeholder="Opções (separadas por vírgula) — sabores ou cores"><br><br>
      <input type="file" name="image" accept="image/*"><br><br>
      <button type="submit">Publicar produto</button>
    </form>
    <hr>
    <p>Os produtos publicados aparecem automaticamente no site.</p>
  </div>
</div>
</body>
</html>
